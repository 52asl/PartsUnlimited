##DocDB; Storage and indexing of Arbitrary Data Structures##

Microsoft Azure DocumentDB is the highly-scalable NoSQL document database-as-a-service that offers rich query and transactions over schema-free data, helps deliver reliable and predictable performance, and enables rapid development.

To highlight the capability of the schema free database we will show an architectural approach to address the schema free and embrace loose typings. This will be shown through storage of the product catalog with products which contain deeply nested attributes and show an approach how they can be shown and queried across.

We also highlight common mistakes made when implementing DocumentDB and ways in which to address them

###Setup###
For this section we assume basic knowledge of settign and consuming DocumentDB inside your application. A comprehensive guide to getting started with DocumentDB can be found [here](https://azure.microsoft.com/en-us/documentation/articles/documentdb-create-account/)

Modifications to Parts Unlimited for this section will require a DocumentDb database account created in Azure.

###Complex arbitraty JSON documents###

1. Allow users to see, a BoM type structure and to search for similar items deep within that structure
where search relies on indexed arbitrary structure
	1. In particular we need to show the power of being able to perform a fast, strongly typed query, on arbitraty data structures
	2. Call out the indexing options
	2. Something where it matters to be numeric, and it matters to be a string, To show that it's not just Full Text Indexing, and we want to be deeply nested
		
###Managing collections and items###

* Talk about wrap around interface to switch out SQL and DocDb
* Talk about Schema free storage, still need to define a schema someplace to use (Whether it’s in the Application or UI layer )
	* Talk about option of storing schema against DB
* Treating collections as tables vs. treating collections as partitions of data
	* A collection is just a collection of documents. Of different schemas.
	* Treat collections as partitions of data. Store different types in the same collection and add a “type” discriminator property to each entry to enable SELECT * FROM c WHERE c.type = “Person” 
	* Request times for multiple collection queries
	* DocumentDB charges a min of $25 per month per collection. Costs of multiple collections for tables

###Querying DocumentDB###

* Search for related products with SQL like query
* Re use document client
* Links to collection using URI Builder
* Re use document client
* Use ID Based Routing wherever possible instead of SelfLinks. UriFactory to generate links based on Ids. 
	* Avoid using selflinks
		* old way - GetOrCreateDatabase and GetOrCreateCollection methods that would get references to Database and DocumentCollection objects so could get the SelfLinks. This results in at least two queries against master resources for every single operation you do. Costly and do it enough times and you will actually get throttled here. 

		* new way - You can now use UriFactory to construct links that are based on Id properties, no need to query for dbs or collections anymore
* Throttling (429)
	* Perhaps reference fault handling stuff (same as Redis ??)
	
* Compare Typed query VS Json document to client
	* JSOn direct to client exists currently. 
	* When a document is retrieved, the internal deserialization process is not triggered untill a property of the document is accessed. e.g. var id = Document.Id.  
	* However, if  a JsonWriter i sused on the document object to get the string, the deserialization overhead is skipped.
	* Additionally, you load from string directly instead of again deserializing string to object and then us doing object to string process again. Resource.LoadFrom does this currently.

###Parts Unlimited updates###

* Re work product storage to utilize DOC DB
* Store something other than products ?? - To show multiple collections VS table
* Search for related products with SQL like query
	* Include Manufacturer, model, **year number**, country origin. Search for products with same and year +/- 3 years as they are similar.
	* Display all products – top 10 – Ryan call out.
