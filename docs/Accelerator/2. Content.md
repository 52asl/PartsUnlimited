##User generated content##

In a e-commerce scenario we want to provide the flexibility for the users of our application to be able to upload custom content and have the application handle it in a way which will not significantly increase hosting costs or cause any end user performance degradation.

In this section we will explore ways in which we can upload and store images and have this content provided through an external source in the form of Azure blob storage. We will capture thumbnails and generate image metadata using Microsoft's Computer Vision APIs and cover ways in which to manage updated user content. Additionally, we will explore integration with the Azure Content Delivery Network (CDN) for providing scalibility when serving content from our application.

For the purpose of demonstrating these scenarios, we will be extending the admin section of Parts Unlimited, in order to enable admins to create and modify product images used throughout the application.

###Setup###

Some initial setup will be required before getting started on the modifications to Parts Unlimited. Guidance can be found for each component below, with information provided regarding configuratin specific to this section.

**TODO-SB** - Flesh out setup as we implement parts unlimited modifications

####Azure blob storage####

This section assumes basic knowledge of configuring and interacting with Azure blob storage within your application. For a detailed guide on getting started, see: https://azure.microsoft.com/en-us/documentation/articles/storage-dotnet-how-to-use-blobs/

**TODO - SB - Call out config relevant to implementation**

####Azure DocumentDB####

This section builds upon the modifications made to Parts Unlimited in the "DocDB; Storage and indexing of Arbitrary Data Structures" section in order to move the existing product catalogue from a SQL implementation to a DocumentDB implementation.
**TODO - SB - Provide link to copy of modifed source**

For a detailed overview of DocumentDB, see: https://azure.microsoft.com/en-us/documentation/articles/documentdb-introduction/

**TODO - SB - Call out config relevant to implementation (if any not already covered in DocDB section)**

####Azure Content Delivery Network (CDN)####

This section assumes basic knowledge of configuring Azure CDN, and integrating with Azure blob storage. For an overview and guide ot getting started see: https://azure.microsoft.com/en-us/documentation/articles/cdn-serve-content-from-cdn-in-your-web-application/

**TODO - SB - Call out config relevant to implementation**

###Creating and storing content###

####Storing content in Azure Storage alongside DocDB####

While it is possible to host images alongside DocumentDB and having the raw content managed through the attachments feature, it is important to note that there is an attachment storage quota, and that integration with Azure CDN could prove difficult as a result of having to resolve the content reference URL through the attachment. Therefore it is reccomended to rather make use of Azure blob storage. This gives us the ability to better manage our own blobs, nullifies storage quota considerations, additional flexibility of simplified integration with Azure CDN, and makes it possible to integrate with Azure Web Jobs and queues for the ability to take time consuming image manipluation tasks out of the regular application process, creating a more responsive end user experience. 

See [here](https://msdn.microsoft.com/en-nz/library/azure/dn782196.aspx) for an overview of the managed attachments features of DocumentDB.

Once an image has been stored inside blob storage, we can store its publicly available URL and other reference metadata inside DocumentDB as an attachment with externally hosted raw content. In this section, we will see an example of various product images stored alongside the product catalogue inside DocumentDB in this manner.

**TODO - SB - Show and expand on the helper code snippets for interacting with our stored content through DocDB/Blobs, once implementation has been solidified**
	
####Manipulating images and extracting metadata####	

When allowing for user generated images to be used within our application, it is important to account for potential raw content with a wide range of display ratios and file sizes. Raw content will need to be manipulated in order to serve images that fit the various design requirements of our application (e.g. image thumbnails, expanded images, and images optimised for display on various devices.). Storing and serving unneccesarily large images degrades the end user experience, and impacts hosting costs, as Azure services such as blob storage and CDN charge by file size.

There are various ways to account for these issues, and in this section we will explore the optimisation of user generated images through the use of Microsoft's Computer Vision APIs - a subset of the Project Oxford initiative, a collection of RESt APIs and SDKs that enable developers to more easily add intelligent services into the applications that leverage Microsoft's natural data understanding capabilities. The Vision API enables us to manipulate our images and extract a wide range of information that includes Optical Character Recognition (OCR), identification of explicit content, image subject matter categorization, colour recognition, etc.

 We will look at processing an image for optimised display, making use of Vision API's "smart crop" feature to generate image thumbnails that focus on the image subject matter, as well as generating full image displays optimised for our application. In addition, we will look at leveraging the Vision API to extract intelligent metadata from our image in the form of categorical image discriptions, and dominant foreground/background colours, which can be used to assist in searches.

See [here](https://www.projectoxford.ai/vision) for an overview of Microsoft's Computer Vision APIs.

**TODO - SB - Expand on snippets of implementation and usage of Vision API**

####Integrating Azure blob storage with Azure CDN####		
	
Remove content serving responsibility from our application and onto the Azure Content Delivery Network (CDN)
	* Improve performance and user experience for end users located farther from content source
	* Removing potential high load from, and improving scalability of our application web server, in particular when multiple HTTP requests are required to serve content heavy pages
		
###Updating stored content###
	
####Cache busting####	
	1. Cache busting with deployments - version number query string
	
	2. Cache busting with user updated content.
	
###Additional considerations for managing user generated content###
		
	1. (Image manipulation - Call out: Recommend processing of images out-of-phase/off line with queue / Web Jobs)
	
	2. (CDN - Call out: load, regionalised sites, Traffic manager (Content and site))	

###Parts Unlimited updates###

Extend Part's Unlimited's admin product section
	1. Remove existing product image URL reference field
	2. Replace with file upload field
	3. Leverage Microsoft's Computer Vision APIs to generate:
		* "Smart cropped" thumbnail
		* Resized, web optimised version of source file for larger display
		* Extract image metadata
	4. Remove locally served content and Integrate with Azure blob storage for image hosting
	5. Store link to images (thumb, resized, etc) in DocDb alongside product with meta data
	6. Wrap CDN across the storage account
	7. Modify image display of Part's Unlimited to link to CDN with query string appending version number
	8. Deployment time, replace image with CDN reference

 




